"use strict";(self.webpackChunkEunoia=self.webpackChunkEunoia||[]).push([[467],{5434:(e,t,n)=>{n.d(t,{FX:()=>a,ae:()=>r,hh:()=>s,kS:()=>i});var o=n(2384);const r=e=>{const[t,n]=["/account/accountData","GET"];(0,o.F)({url:t,method:n},(t=>e(t)))},a=(e,t)=>{const[n,r]=["/account/saveProfileInfo","PUT"];(0,o.F)({url:n,method:r,body:e},(e=>t(e)))},s=(e,t)=>{const[n,r]=["/account/setNotify","PUT"];(0,o.F)({url:n,method:r,body:e},(e=>t(e)))},i=e=>{const[t,n]=["/auth/logout","DELETE"];(0,o.F)({url:t,method:n},(t=>e(t)))}},5395:(e,t,n)=>{n.d(t,{W:()=>a,a:()=>r});var o=n(2384);const r=({sender:e,chatId:t})=>{const n={sender:e,chatId:t};(0,o.F)({method:"PUT",url:"/chat/saveUnread",body:n})},a=({username:e},t)=>{const n=`/chat/fetchMessages/${e}`;(0,o.F)({method:"GET",url:n},(e=>t(e)))}},8312:(e,t,n)=>{n.d(t,{Ln:()=>d,Wk:()=>i,cY:()=>s,eC:()=>c,eb:()=>a,ox:()=>r});var o=n(2384);const r=(e,t)=>{const n=`/chat/fetchGroupInfo/${e}`;(0,o.F)({url:n,method:"GET"},(e=>t(e)))},a=({body:e,groupId:t})=>{const n=`/chat/starGroup/${t}`;console.log(e),(0,o.F)({url:n,method:"PUT",body:e})},s=e=>{(0,o.F)({url:"/chat/setGroupUnread",method:"PUT",body:e},(e=>cb(e)))},i=(e,t)=>{(0,o.F)({url:"/chat/clearGroupUnread",method:"PUT",body:e},(e=>t(e)))},c=({groupId:e},t)=>{const n=`/chat/fetchGroupChats/${e}`;(0,o.F)({url:n,method:"GET"},(e=>t(e)))},d=e=>{const[t,n]=["/chat/deleteGroup","DELETE"];(0,o.F)({url:t,method:n,body:e})}},9008:(e,t,n)=>{n.d(t,{Pq:()=>s,YR:()=>a,fq:()=>r});var o=n(2384);const r=async e=>{(0,o.F)({url:"/chat/recentChats",method:"GET"},(t=>e(t)))},a=async e=>{(0,o.F)({url:"/chat/starConversation",method:"PUT",body:e})},s=async e=>{const[t,n]=["/chat/clearConversation","DELETE"];(0,o.F)({url:t,method:n,body:e})}},1467:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});var o=n(7294),r=n(9704),a=n(6974),s=n(1120),i=n(6367),c=n(3084);const d=n(2788).ZP.div`
	display: flex;
	justify-content: center;
	align-items: center;
	margin: 50px;
	flex-direction: column;

	em {
		color: #555674;
		margin-top: 10px;
	}
`;function u(){return o.createElement(d,null,o.createElement(c.Preloader,{use:c.Circles,size:60,strokeWidth:6,strokeColor:"cornflowerblue",duration:2e3}),o.createElement("em",null,"Organizing your chat experience..."))}var l=n(6614),h=n(3961),f=n(5403),m=n(6257),p=n(9700),g=n(9585),y=n(5076),G=n(2005),T=n(6140),v=n(5434),I=n(9008),E=n(2384);const U=e=>{(0,E.F)({url:"/account/users",method:"GET"},(t=>e(t)))};var W=n(8312),F=n(5395);const C=o.lazy((()=>n.e(579).then(n.bind(n,1579)))),S=(0,s.Z)({main:{background:"linear-gradient(266deg, #e9e9e9, #d3920026)",display:"flex",height:"100%"}}),_=({user:e})=>{const{id:t,username:n}=(0,r.v9)((e=>e.account.account)),s=S(),c=(0,r.I0)(),d=(0,r.v9)((e=>e.other.currentSelectedUser)),{leftPane:E,rightPane:_,app:b}=(0,r.v9)((e=>e.components)),x=(0,r.v9)((e=>e.activeUsers.activeUsers)),w=(0,r.v9)((e=>e.groups.selectedGroup)),D=((0,r.v9)((e=>e.other.fetched)),(0,r.v9)((e=>e.groups.fetchedGroups)),(0,i.x)()),{useEffect:N}=o;return N((()=>{(0,T.Z)({token:t,username:n}),(0,v.ae)((e=>{c((0,f.Y)(e)),e&&c((0,g.F$)(!0))})),(0,I.fq)((e=>{c((0,l.rO)(e)),T.W.emit("getOnileUsers")})),U((e=>{c((0,h.i9)(e)),T.W.emit("getOnileUsers")}))}),[]),T.W.off("connect").on("connect",(()=>{c((0,f.VT)(!0))})),T.W.off("disconnect").on("disconnect",(e=>{c((0,f.VT)(!1))})),T.W.off("onlineUsers").on("onlineUsers",(e=>{c((0,h.IF)(e.filter((e=>e.username!==n)))),c((0,p.Rx)(e.filter((e=>e.username!==n))))})),T.W.off("userDisconnect").on("userDisconnect",(e=>{c((0,h.Ov)(e)),c((0,p.Fz)(e))})),T.W.off("starredChat").on("starredChat",((e,t)=>{c((0,m.Fb)({friendsName:e,starredChat:t}))})),T.W.off("deleteChat").on("deleteChat",(e=>{c((0,m.Rm)(e)),c((0,l.Tt)(e))})),T.W.off("fetchGroupInfo").on("fetchGroupInfo",(({_id:e})=>{(0,W.ox)(e,(e=>{c((0,l.it)(e))}))})),T.W.off("setGroupSettings").on("setGroupSettings",(({_id:e,settings:t})=>{c((0,y.AN)({_id:e,field:{settings:t}}))})),T.W.off("setGroupDesc").on("setGroupDesc",(({_id:e,description:t})=>{c((0,y.AN)({_id:e,field:{description:t}}))})),T.W.off("setGroupName").on("setGroupName",(({_id:e,name:t})=>{(0,W.ox)(e,(e=>{c((0,l.it)(e))})),c((0,y.AN)({_id:e,field:{name:t}}))})),T.W.off("setGroupAdmins").on("setGroupAdmins",(({_id:e,admins:t})=>{c((0,y.AN)({_id:e,field:{admins:t}}))})),T.W.off("addGroupParticipants").on("addGroupParticipants",(({_id:e,participants:t})=>{(0,W.ox)(e,(e=>{c((0,l.it)(e))})),c((0,y.AN)({_id:e,field:{participants:t}}))})),T.W.off("removeGroupUser").on("removeGroupUser",(({_id:e,participants:t,admins:n})=>{c((0,y.AN)({_id:e,field:{participants:t,admins:n}}))})),T.W.off("chatFromGroup").on("chatFromGroup",(({_id:e,chat:t})=>{c((0,y.CG)({_id:e,chat:t})),((0,G.hu)(w)&&w._id!==e||!(0,G.hu)(w))&&((0,W.cY)({groupId:e,chatId:t.chatId}),c((0,l.w)({_id:e,chatId:t.chatId}))),c((0,l.p5)({_id:e,lastChat:t}))})),T.W.off("deleteGroupChat").on("deleteGroupChat",(({_id:e,chatId:t})=>{c((0,y.VV)({_id:e,chatId:t})),c((0,l.Kv)({_id:e,chatId:t}))})),T.W.off("groupTyping").on("groupTyping",(({_id:e,username:t,typing:n})=>{c((0,y.Zv)({_id:e,username:t,typing:n})),c((0,l.l4)({_id:e,username:t,typing:n}))})),T.W.off("chatFromUser").on("chatFromUser",(e=>{function t(){c((0,m.lC)(e)),c((0,l.IJ)({username:e.sender,lastChat:e.message})),(0,G.hu)(d)&&d.username===e.sender||((0,F.a)({sender:e.sender,chatId:e.message.chatId}),c((0,l.LP)({friendsName:e.sender,chatId:e.message.chatId})))}x.find((t=>t.username===e.sender))?t():U((e=>{c((0,h.i9)(e)),T.W.emit("getOnileUsers"),t()})),(0,G.hu)(d)&&d.username===e.sender&&T.W.emit("chatIsRead",{sender:d.username,receiver:n})})),T.W.off("chatHasBeenRead").on("chatHasBeenRead",(({sender:e,receiver:t})=>{c((0,m.dA)(t)),c((0,l.QG)(t))})),T.W.off("userIsTyping").on("userIsTyping",(e=>{c((0,l.f8)(e)),c((0,h.t5)(e))})),b.display?o.createElement("section",{className:s.main,style:{height:D+"px"}},E&&o.createElement(C,null),o.createElement(a.j3,null)):o.createElement(u,null)}},4199:(e,t,n)=>{n.d(t,{$s:()=>r,DH:()=>a,cK:()=>o});const o=(e,t)=>{const{jwt:n,username:o,id:r}=e;sessionStorage.setItem("jwt",JSON.stringify(n)),localStorage.setItem("user",JSON.stringify({username:o,id:r})),t()},r=e=>{sessionStorage.setItem("jwt",JSON.stringify(e))},a=()=>{sessionStorage.clear(),localStorage.clear()}},2005:(e,t,n)=>{function o(e){let t,n,o=e.toDateString(),r=o.match(/[0-9][0-9][0-9][0-9]/);return null!==r&&(t=r[0],n=o.slice(0,r.index-1)),{year:t,day:n}}function r(e=new Date){let t=e.toDateString();const n=/[0-9](?=[0-9]{3})/.exec(t).index,o=t.split("").splice(n).join(""),r=t.split("").splice(0,n-1).join(""),a=e.toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"});return{year:o,day:r,fullDate:e.toString(),time:a}}function a(e,t){const n=o(new Date(e)),r=o(new Date);return n.day===r.day?t.time:n.day}function s(e){if(!e)return"recently";let t=new Date,n=new Date(e),o=n.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"});if(n.toDateString()===t.toDateString())return o;{let e=n.toDateString(),t=/[0-9](?=[0-9]{3})/.exec(e).index;return e.split("").splice(0,t-1).join("")}}function i(e){try{if(null==e)return!1;if("number"==typeof e)return-1!==e;if("boolean"==typeof e)return e;if(Array.isArray(e))return e.length>0;if(Object.keys(e).length>0)return!0}catch(e){return e}return!1}n.d(t,{Co:()=>a,hi:()=>r,hu:()=>i,xq:()=>s})},2384:(e,t,n)=>{n.d(t,{F:()=>a});var o=n(4199);function r(e){const{id:t}=JSON.parse(localStorage.getItem("user")),n=new Headers;n.append("Content-Type","application/json"),n.append("Authorization",`Bearer ${t}`),fetch("/auth/refresh",{method:"GET",headers:n}).then((e=>e.json())).then((t=>{(0,o.$s)(t.jwt),e()}))}async function a(e,t=(()=>{})){const{method:n,url:o}=e,s=new Headers;if(s.append("Content-Type","application/json"),"GET"===n.toUpperCase())try{let i=await fetch(o,{method:n,headers:s});return void(i.ok?t(await i.json()):401===i.status&&"Unauthorized"===i.statusText&&r((()=>a(e,t))))}catch(e){}else try{let i=e?.body||{},c=await fetch(o,{method:n,headers:s,body:JSON.stringify(i)});c.ok?t(await c.json()):401===c.status&&"Unauthorized"===c.statusText&&r((()=>a(e,t)))}catch(e){}}},6140:(e,t,n)=>{n.d(t,{W:()=>o,Z:()=>r});const o=(0,n(3992).io)("/user",{autoConnect:!1,forceNew:!0});function r(e){const{token:t,username:n}=e;o.auth={token:t,username:n},o.connect()}}}]);